<div class="view-container">

  <div class="title-two">
    Actividades del docente {{ userTeacherInfo?.nombreDocente | titlecase }}
  </div>
  <div class="messages-container">
    <img src="assets/icons/messages/teacher.svg" alt="teacher-icon">
    <span class="text-body-heavy">A continuación, encontrará el listado de actividades del docente {{userTeacherInfo?.nombreDocente}} asignadas para el periodo {{userTeacherInfo?.periodoAcademico}}. En esta vista podrá ver el datalle de la evaluación de las fuentes de cada actividad, el estado de cada fuente, descargar el consolidado y todos los archivos de soporte.</span>
</div>

  <div class="mb-3"></div>
  <!-- Información del docente -->
  <section>
    <span class="title-three">Información del docente</span>
    <div class="mb-1"></div>
    <table class="table-bordered">
      <thead>
        <tr>
          <th>
            <span class="text-body-regular">Nombres y apellidos</span>
            <br />
            <span class="text-body-small-sb">{{
              this.userTeacherInfo?.nombreDocente
            }}</span>
          </th>
          <th>
            <span class="text-body-regular">Num.Id</span>
            <br />
            <span class="text-body-small-sb">{{
              userTeacherInfo?.numeroIdentificacion
            }}</span>
          </th>
          <th>
            <span class="text-body-regular">Vinculación</span>
            <br />
            <span class="text-body-small-sb">{{
              userTeacherInfo?.categoria
            }}</span>
          </th>
          <th>
            <span class="text-body-regular">Dedicación</span>
            <br />
            <span class="text-body-small-sb"
              >{{ userTeacherInfo?.dedicacion }}
            </span>
          </th>
        </tr>
        <tr>
          <th>
            <span class="text-body-regular">
              <span class="text-body-regular">Facultad</span>
              <br />
              <span class="text-body-small-sb">{{
                userTeacherInfo?.facultad
              }}</span>
            </span>
          </th>
          <th>
            <span class="text-body-regular">Departamento</span>
            <br />
            <span class="text-body-small-sb">{{
              userTeacherInfo?.departamento
            }}</span>
          </th>
          <th>
            <span class="text-body-regular">Periodo consolidado</span>
            <br />
            <span class="text-body-small-sb">{{
              userTeacherInfo?.periodoAcademico
            }}</span>
          </th>
          <th>
            <span class="text-body-regular">Total horas</span>
            <br />
            <span class="text-body-small-sb">{{
              userTeacherInfo?.horasTotales
            }}</span>
          </th>
        </tr>
      </thead>
    </table>
  </section>
  <div class="mb-3"></div>
  <section>
    <span class="title-three">Actividades</span>
    <cpd-activity-filter
      (filterParams)="filterAction($event)"
    ></cpd-activity-filter>
    <table class="table-bordered">
      <thead>
        <tr>
          <th class="text-body-heavy text-center">Actividades</th>
          <th class="text-body-heavy text-center" colspan="3">
            Autoevaluación
          </th>
          <th class="text-body-heavy text-center" colspan="4">Fuente 2</th>
        </tr>
        <tr>
          <th class="text-body-regular">Nombre actividad</th>
          <th class="text-body-regular">Estado</th>
          <th class="text-body-regular">Evaluación</th>
          <th class="text-body-regular">Acciones</th>
          <th class="text-body-regular">Evaluador</th>
          <th class="text-body-regular">Estado</th>
          <th class="text-body-regular">Evaluación</th>
          <th class="text-body-regular">Acciones</th>
        </tr>
      </thead>
      <ng-container
        *ngIf="
          teacherActivities && teacherActivities.content.length > 0;
          else noData
        "
      >
        <tbody>
          <ng-container *ngFor="let activityType of activitiesByType">
            <tr>
              <td colspan="6" class="text-body-regular text-center">
                {{ activityType.nombreType }}
              </td>
            </tr>
            <tr *ngFor="let activity of activityType.activities">
              <td>
                {{ activity.nombreActividad }}
              </td>
              <td>
                <span
                  class="text-body-regular"
                  *ngIf="activity.fuentes[0].tipoFuente == '1'"
                  >{{ activity.fuentes[0].estadoFuente }}</span
                >
              </td>
              <td>
                <span
                  class="text-body-regular"
                  *ngIf="activity.fuentes[0].tipoFuente == '1'"
                  >{{ activity.fuentes[0].calificacion }}</span
                >
              </td>
              <td>
                <button
                  class="button-table-view"
                  *ngIf="
                    activity.fuentes[0].tipoFuente == '1' &&
                    activity.fuentes[0].estadoFuente === 'DILIGENCIADO'
                  "
                  (click)="openSourceOne(activity)"
                ></button>
              </td>
              

              <td>
                <span class="text-body-regular"
                  >{{ activity.evaluador.nombres }}
                  {{ activity.evaluador.apellidos }}</span
                >
              </td>
              <td>
                <span
                  class="text-body-regular"
                  *ngIf="activity.fuentes[1].tipoFuente == '2'"
                  >{{ activity.fuentes[1].estadoFuente }}</span
                >
              </td>
              <td>
                <span
                  class="text-body-regular"
                  *ngIf="activity.fuentes[1].tipoFuente == '2'"
                  >{{ activity.fuentes[1].calificacion }}</span
                >
              </td>
              <td>
                <button
                  class="button-table-view"
                  *ngIf="
                    activity.fuentes[1].tipoFuente == '2' &&
                    activity.fuentes[1].estadoFuente === 'DILIGENCIADO'
                  "
                  (click)="openSourceTwo(activity)"
                ></button>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </ng-container>
      <ng-template #noData>
        <tbody>
          <tr>
            <td colspan="6" class="text-body-regular text-center">
              No hay actividades registradas
            </td>
          </tr>
        </tbody>
      </ng-template>
    </table>
  </section>

  <div class="mb-3"></div>

  <shared-paginator
    class="d-flex justify-content-center"
    [currentPage]="currentPage"
    [totalPages]="teacherActivities?.totalPages || 1"
    (pageChange)="pageChanged($event)"
  ></shared-paginator>

  <!-- Resumen evaluación actividades -->
  <section>
    <div
      class="row"
      style="margin-right: 0% !important; margin-left: 0% !important"
    >
      <div class="col messages-container">
        <span class="text-body-regular">% Total: </span>
        <span class="text-body-heavy"
          >{{ userTeacherInfo?.totalPorcentaje }}%</span
        >
      </div>
      <div class="col-1"></div>
      <div class="col messages-container">
        <span class="text-body-regular">Total acumulado: </span>
        <span class="text-body-heavy">{{
          userTeacherInfo?.totalAcumulado
        }}</span>
      </div>
    </div>
  </section>

  <div class="mb-3"></div>
  <section>
    <div class="row">
      <div class="col">
        <span class="title-three">Descargar consolidado</span>
        <div class="buttons-container">
          <div>
            <span class="text-bod">Consolidado</span>
            <br />
          </div>
          <button
            class="button-actions button-download"
            (click)="downloadConsolidatedFiles()"
          ></button>
        </div>
      </div>
      <div class="col">
        <span class="title-three">Descargar todos los soportes</span>
        <div class="buttons-container">
          <div>
            <span class="text-bod">Soportes</span>
            <br />
          </div>
          <button
            class="button-actions button-download"
            (click)="downloadFiles()"
          ></button>
        </div>
      </div>
    </div>
  </section>

  <div class="mb-3"></div>

  <div class="d-flex justify-content-center">
    <button class="button-normal" (click)="goBack()">Volver</button>
  </div>
</div>
<cpd-view-details-source-one></cpd-view-details-source-one>
<cpd-view-details-source-two></cpd-view-details-source-two>
